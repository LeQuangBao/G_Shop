@model PagedList.IPagedList<G_Shop.Models.NguoiDung>
@using PagedList.Mvc
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}
<script>
    $(document).ready(function () {
        $('#them').on('click', function () {
            var tendangnhap = $("#tendangnhap").val();
            var matkhau = $("#matkhau").val();
            var matkhau1 = $("#matkhau1").val();
            var ngaysinh = $("#ngaysinh").val();
            var gioitinh = $("#gioitinh").val();
            if (matkhau != matkhau1) {
                $("#thongbao").text = "Mật khẩu chưa khớp";
            }
            var email = $("#email").val();
            var sodienthoai = $("#sodienthoai").val();
            var vaitro = $("#vaitro").val();
            console.log(vaitro);
            $.ajax({
                type: "POST",
                url: '/User/themnguoidung',
                data: {
                    tendangnhap: tendangnhap,
                    matkhau: matkhau,
                    gioitinh: gioitinh,
                    ngaysinh:ngaysinh,
                    email: email,
                    sodienthoai: sodienthoai,
                    vaitro: vaitro
                },
                cache: false,
                dataType: "json",
                success: function (result) {
                    if (result == "ok") {
                        alert("Thêm thành công");
                        setTimeout(function () {
                            location.reload();
                        }, 2000);
                    }


                },
                error: function (err) {
                    console.log(err.status + " - " + err.statusText);
                }
            });
        });
        $("#sua").on('click', function () {
            var ma = $("#ma").val();
            $.ajax({
                type: "POST",
                url: '/User/sua',
                data: {
                   ma:ma
                },
                cache: false,
                dataType: "json",
                success: function (result) {
                    console.log(ma);
                    console.log(result);
                    $("#ma1").val(ma);
                    $("#tendangnhap1").val(result.TenDangNhap);
                    $("#matkhau2").val(result.MatKhau);
                    $("#gioitinh1").val(result.GioiTinh);
                    $("#email1").val(result.Email);
                    $("#sodienthoai1").val(result.SoDienThoai);
                    
                    $("#ngaysinh1").val(ToJavaScriptDate(result.NgaySinh));
                    $("#vaitro1").val(result.VaiTro);
                },
                error: function (err) {
                    console.log(err.status + " - " + err.statusText);
                }
            });
        });
        $("#capnhat").on('click', function () {
            var ma = $("#ma").val();
            var tendangnhap = $("#tendangnhap1").val();
            var matkhau = $("#matkhau2").val();
            var ngaysinh = $("#ngaysinh1").val();
            var gioitinh = $("#gioitinh1").val();   
            var email = $("#email1").val();
            var sodienthoai = $("#sodienthoai1").val();
            var vaitro = $("#vaitro1").val();
            console.log(vaitro);
            $.ajax({
                type: "POST",
                url: '/User/capnhat',
                data: {
                    ma:ma,
                    tendangnhap: tendangnhap,
                    matkhau: matkhau,
                    gioitinh: gioitinh,
                    ngaysinh: ngaysinh,
                    email: email,
                    sodienthoai: sodienthoai,
                    vaitro: vaitro
                },
                cache: false,
                dataType: "json",
                success: function (result) {
                    if (result == "ok") {
                        alert("Sửa thành công");
                        setTimeout(function () {
                            location.reload();
                        }, 2000);
                    }


                },
                error: function (err) {
                    console.log(err.status + " - " + err.statusText);
                }
            });
        });
    });
    function ToJavaScriptDate(value) {
        var pattern = /Date\(([^)]+)\)/;
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
    }
</script>

<link href="~/Scripts/dropzone/basic.css" rel="stylesheet" />
<link href="~/Scripts/dropzone/dropzone.css" rel="stylesheet" />
<div class="col-lg-12">
    <h2>
        Quản lí người dùng
        <span style="float:right">
            <button class="btn btn-primary" data-toggle="modal" data-target="#myModal_them"><i class="glyphicon glyphicon-plus"></i> Thêm</button>
        </span>
    </h2>
    <div class="col-md-5 col-sm-5 col-xs-12 form-group top_search" style="margin-left:200px">
        <form action="/Admin/User/timkiemnguoidung" method="post">
            <div @*style="width:500px"*@ class="input-group col-lg-offset-2">
                <input type="text" name="txttimkiem" id="keyword" class="form-control" placeholder="Tìm kiếm..." required>
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit" id="search">Tìm kiếm</button>
                </span>
            </div>
        </form>

    </div>
    <div class="col-md-6">
        <dl class="dl-horizontal">
            <dt>
                Tổng số người dùng:
            </dt>

            <dd>
                @Model.Count
            </dd>
        </dl>
    </div>
    <div role="tabpanel" class="tab-pane" id="list">
        <table id="datatable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên đăng nhập</th>
                    <th>Email</th>
                    <th>Số điện thoại</th>
                    <th>Vai trò</th>
                    <th>Điều khiển</th>
                </tr>
            </thead>
            <tbody>
                @for(var i = 0; i < Model.Count; i++) {
                    <tr>
                        <td>@(i + 1)</td>
                        <td>@Model[i].TenDangNhap</td>
                        <td>@Model[i].Email</td>
                        <td>@Model[i].SoDienThoai</td>
                        <td>@Model[i].VaiTro</td>
                        <td>
                            <input type="hidden" value="@Model[i].MaNguoiDung" id="ma" />
                                <button  class="btn btn-primary" data-toggle="modal"  data-target="#myModal_sua">
                                    <i class="glyphicon glyphicon-pencil" id="sua">
                                        Sửa
                                    </i>

                                </button>
                          
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="row">
        <div class="col-lg-offset-4">
            @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
        </div>
    </div>
</div>
<section>
    <!-- Modal Thêm người dùng -->
    <div class="modal fade" id="myModal_them" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Thêm người dùng</h4>
                </div>
                <div class="modal-body">
                    <form id="add" name="add" class="form-horizontal" role="form" method="post">
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Tên đăng nhập <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="text" id="tendangnhap" name="tendangnhap" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Mật khẩu <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="password" id="matkhau" name="password" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Nhập lại mật khẩu <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="password" id="matkhau1" name="password" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Ngày sinh <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="text" id="ngaysinh" placeholder="MM/dd/yyyy" name="ngaysinh" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="middle-name" class="control-label col-md-3 col-sm-3 col-xs-12">
                                Email
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="email" class="form-control col-md-7 col-xs-12" type="text" name="middle-name">

                            </div>
                            </div>
                        <div class="form-group">
                            <label for="middle-name" class="control-label col-md-3 col-sm-3 col-xs-12">
                                Giới tính
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">        
                                <select id="gioitinh" class="form-control">
                                    <option value="Nữ">Nữ</option>
                                    <option value="Nam">Nam</option>
                                </select>

                            </div>
                        </div>
                            <div class="form-group">
                                <label class="control-label col-md-3 col-sm-3 col-xs-12">
                                    Số điện thoại <span class="required">*</span>
                                </label>
                                <div class="col-md-6 col-sm-6 col-xs-12">
                                    <input id="sodienthoai" name="sodienthoai" class="date-picker form-control col-md-7 col-xs-12" required="required" type="text">
                                </div>
                            </div>
   
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">
                                Vai trò <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                @*<input id="sdt" name="phone" class="date-picker form-control col-md-7 col-xs-12" required="required" type="text">*@
                                <select class="date-picker form-control col-md-7 col-xs-12" id="vaitro">
                                    <option value="Khách hàng">Khách hàng</option>
                                    <option value="Quản trị viên">Người quản trị</option>
                                </select>
                            </div>
                        </div>
                    <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">

                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <button type="button" class="btn btn-primary" id="them">Thêm</button>
                        </div>
                    </div>
                    </form>
                </div>
                <div class="modal-footer">
                    @*<button type="button" class="btn btn-primary" id="them">Lưu</button>*@
                    <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal sửa người dùng-->
    <div class="modal fade" id="myModal_sua" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Sửa người dùng</h4>
                </div>
                <div class="modal-body">
                    <form id="add" name="add" class="form-horizontal" role="form" method="post">
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Tên đăng nhập <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="text" id="tendangnhap1" name="tendangnhap" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Mật khẩu <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="password" id="matkhau2" name="password" required="required" class="form-control col-md-7 col-xs-12">
                            </div>
                        </div>
                     
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="last-name">
                                Ngày sinh <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input type="text" id="ngaysinh1" placeholder="MM/dd/yyyy" name="ngaysinh" required="required" class="form-control col-md-7 col-xs-12">
                                <p>Định dạng: MM/dd/yyyy</p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="middle-name" class="control-label col-md-3 col-sm-3 col-xs-12">
                                Email
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="email1" class="form-control col-md-7 col-xs-12" type="text" name="middle-name">

                            </div>
                        </div>
                        <div class="form-group">
                            <label for="middle-name" class="control-label col-md-3 col-sm-3 col-xs-12">
                                Giới tính
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <select id="gioitinh1" class="form-control">
                                    <option value="Nữ">Nữ</option>
                                    <option value="Nam">Nam</option>
                                </select>

                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">
                                Số điện thoại <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <input id="sodienthoai1" name="sodienthoai" class="date-picker form-control col-md-7 col-xs-12" required="required" type="text">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">
                                Vai trò <span class="required">*</span>
                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                @*<input id="sdt" name="phone" class="date-picker form-control col-md-7 col-xs-12" required="required" type="text">*@
                                <select class="date-picker form-control col-md-7 col-xs-12" id="vaitro1">
                                    <option value="Khách hàng">Khách hàng</option>
                                    <option value="Quản trị viên">Người quản trị</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3 col-sm-3 col-xs-12">

                            </label>
                            <div class="col-md-6 col-sm-6 col-xs-12">
                                <button type="button" class="btn btn-primary" id="capnhat">Sửa</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    @*<button type="button" class="btn btn-primary" id="them">Lưu</button>*@
                    <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

</section>


